plotvar   = "uEast_surface5m",
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE,
maxD  = max(as.vector(uE%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
uE<-uE%>%mutate(type = "April-June")
plotTS(uE)
source("D:/GitHub_cloud/ACLIM2/R/sub_fun/plotTS.R")
NRS_vars <- rbind(vN,uE)
plotTS(NRS_vars )
df <- get_var( typeIN    = "Seasonal",
SeasonIN =  "Summer",
plotvar   = varlist[1],
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
dir("Data/out")
dir("Data/out/K20P19_CMIP6")
dir("Data/out/K20P19_CMIP6/allEBS_means")
load("Data/out/K20P19_CMIP6/allEBS_means/ACLIM_seasonal_hind_mn.Rdata")
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotvar   = varlist[1],
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
df$data
head(df$dat)
dim(df$dat)
BT <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
dim(BT)
BT <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
BT <- stitchTS(dat = BT,
maxD  = max(as.vector(BT%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
NRS_vars <- rbind(NRS_vars,BT)
plotTS(NRS_vars )
source("D:/GitHub_cloud/ACLIM2/R/sub_fun/plotTS.R")
plotTS(NRS_vars )
get_var
get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS","NEBS"),
plotvar   = varlist[1],
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
NRS_vars <- rbind(vN,uE)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp,
maxD  = max(as.vector(tmp%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
NRS_vars <- rbind(NRS_vars,tmp)
}
plotTS(NRS_vars )
# get the variable you want:
df <- get_var( typeIN    = "annual",
plotvar   = varlist[3],
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
df$plot+coord_cartesian(ylim = c(0, 7))
head(df$dat)
grpby <- c("long_name","type","lognorm","var","basin",
"year","sim","gcmcmip","GCM","scen","sim_type",
"units","bc","GCM_scen","GCM_scen_sim", "CMIP")
sumat <- c("jday","mnDate","mn_val")
# get the variable you want:
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
vN <- df$dat%>%
group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
vN <- stitchTS(dat = vN,
maxD  = max(as.vector(vN%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
vN<-vN%>%mutate(type = "NRS indices")
plotTS(vN)
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "uEast_surface5m",
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE,
maxD  = max(as.vector(uE%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
uE<-uE%>%mutate(type = "NRS indices")
NRS_vars <- rbind(vN,uE)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "raw",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp,
maxD  = max(as.vector(tmp%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
tmp<-tmp%>%mutate(type = "NRS indices")
NRS_vars <- rbind(NRS_vars,tmp)
}
plotTS(NRS_vars )
get_var
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
# get the variable you want:
df <- get_var( typeIN    = "annual",
plotvar   = varlist[3],
bcIN      = c("raw","bias corrected"),
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
df$plot+coord_cartesian(ylim = c(0, 7))
# get the variable you want:
df <- get_var( typeIN    = "annual",
plotvar   = "temp_bottom5m",
bcIN      = c("raw","bias corrected"),
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
df$plot+coord_cartesian(ylim = c(0, 7))
head(df$dat)
# Now compile the NRS indices:
#--------------------------------------
grpby <- c("long_name","type","lognorm","var","basin",
"year","sim","gcmcmip","GCM","scen","sim_type",
"units","bc","GCM_scen","GCM_scen_sim", "CMIP")
sumat <- c("jday","mnDate","mn_val")
# get the variable you want:
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
vN <- df$dat%>%
group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
vN <- stitchTS(dat = vN,
maxD  = max(as.vector(vN%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
vN<-vN%>%mutate(type = "NRS indices")
#plotTS(vN)
rm(df)
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "uEast_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE,
maxD  = max(as.vector(uE%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
uE<-uE%>%mutate(type = "NRS indices")
NRS_vars <- rbind(vN,uE)
rm(df)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp,
maxD  = max(as.vector(tmp%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]]))
tmp<-tmp%>%mutate(type = "NRS indices")
NRS_vars <- rbind(NRS_vars,tmp)
rm(df)
}
plotTS(NRS_vars )
save(NRS_vars, file="Data/out/NRS_vars.Rdata")
?reshape2::cast
reshape2::cast(NRS_vars,~var )
reshape2::dcast(NRS_vars,~var )
source("D:/GitHub_cloud/ACLIM2/R/sub_fun/get_var.R")
tidyr::pivot_wider(NRS_vars, id_cols = grpby,names_from = var, values_from = mn_val)
tidyr::pivot_wider(NRS_vars, ,names_from = var, values_from = mn_val)
head(tidyr::pivot_wider(NRS_vars, ,names_from = var, values_from = mn_val))
head(tidyr::pivot_wider(NRS_vars, ,names_from = var, values_from = mn_val))
tail(tidyr::pivot_wider(NRS_vars, ,names_from = var, values_from = mn_val))
NRS_vars%>%select(accross(all_of(c(grpby,"mn_val"))))%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
NRS_vars%>%select(across(all_of(c(grpby,"mn_val"))))%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
NRS_vars%>%select(across(all_of(c(grpby,"mn_val"))))
NRS_vars%>%select(all_of(c(grpby,"mn_val"))))
NRS_vars%>%select(all_of(c(grpby,"mn_val")))
NRS_vars%>%select(all_of(c(grpby,"mn_val")))%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
head( NRS_vars%>%select(all_of(c(grpby,"mn_val")))%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val))
grpby
NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
tail(NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val))
tail(NRS_vars%>%group_by(across(all_of(grpby)))%>%filter(year<2080,year>2000)%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val))
plotTS(NRS_vars )
head(NRS_vars)
head(NRS_vars$mn_val)
tail(NRS_vars$mn_val)
tail(NRS_vars$mn_val)
NRS_vars<-NRS_vars%>%ungroup()
plotTS(NRS_vars )
NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
wide<- NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
wide$temp_bottom5m
plot(wide$temp_bottom5m)
NRS_vars%>%filter(var=="temp_bottom5m")
NRS_vars%>%filter(var=="temp_bottom5m")%>%select(mn_val)
as.numeric(NRS_vars%>%filter(var=="temp_bottom5m")%>%select(mn_val))
unlist(NRS_vars%>%filter(var=="temp_bottom5m")%>%select(mn_val))
unlist(NRS_vars%>%filter(var=="temp_bottom5m")
NRS_vars%>%filter(var=="temp_bottom5m")
aa<-NRS_vars%>%filter(var=="temp_bottom5m")
plotTS(aa)
aa$GCM_scen
aa<-NRS_vars%>%filter(var=="temp_bottom5m",GCM_scen=="miroc_ssp585")
plotTS(aa)
aa
aa$mn_val
aa$year
aa$year[aa$mn_val==NA]
aa$year[is.na(aa$mn_val)]
max(as.vector(tmp%>%
filter(sim_type=="hind")%>%
ungroup()%>%
select(mnDate))[[1]])
stitchDate <- "2020-12-30"
grpby <- c("long_name","type","lognorm","var","basin",
"year","sim","gcmcmip","GCM","scen","sim_type",
"units","bc","GCM_scen","GCM_scen_sim", "CMIP")
sumat <- c("jday","mnDate","mn_val")
# get the variable you want:
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
vN <- df$dat%>%
group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
vN <- stitchTS(dat = vN, stitchDate)
vN<-vN%>%mutate(type = "NRS indices")
#plotTS(vN)
rm(df)
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "uEast_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE, stitchDate)
uE<-uE%>%mutate(type = "NRS indices")
NRS_vars <- rbind(vN,uE)
rm(df)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp, stitchDate)
tmp<-tmp%>%mutate(type = "NRS indices")
NRS_vars <- rbind(NRS_vars,tmp)
rm(df)
}
NRS_vars<-NRS_vars%>%ungroup()
plotTS(NRS_vars )
save(NRS_vars, file="Data/out/NRS_vars.Rdata")
wide<- NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
aa<-NRS_vars%>%filter(var=="temp_bottom5m",GCM_scen=="miroc_ssp585")
aa$year[is.na(aa$mn_val)]
plotTS(aa)
stitchDate <- "2021-12-30"
grpby <- c("long_name","type","lognorm","var","basin",
"year","sim","gcmcmip","GCM","scen","sim_type",
"units","bc","GCM_scen","GCM_scen_sim", "CMIP")
sumat <- c("jday","mnDate","mn_val")
# get the variable you want:
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
vN <- df$dat%>%
group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
vN <- stitchTS(dat = vN, stitchDate)
vN<-vN%>%mutate(type = "NRS indices")
#plotTS(vN)
rm(df)
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "uEast_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE, stitchDate)
uE<-uE%>%mutate(type = "NRS indices")
NRS_vars <- rbind(vN,uE)
rm(df)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp, stitchDate)
tmp<-tmp%>%mutate(type = "NRS indices")
NRS_vars <- rbind(NRS_vars,tmp)
rm(df)
}
NRS_vars<-NRS_vars%>%ungroup()
plotTS(NRS_vars )
save(NRS_vars, file="Data/out/NRS_vars.Rdata")
wide<- NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
aa<-NRS_vars%>%filter(var=="temp_bottom5m",GCM_scen=="miroc_ssp585")
aa$year[is.na(aa$mn_val)]
plotTS(aa)
# Now compile the NRS indices:
#--------------------------------------
stitchDate <- "2020-12-30"
grpby <- c("long_name","type","lognorm","var","basin",
"year","sim","gcmcmip","GCM","scen","sim_type",
"units","bc","GCM_scen","GCM_scen_sim", "CMIP")
sumat <- c("jday","mnDate","mn_val")
# get the variable you want:
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "vNorth_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
vN <- df$dat%>%
group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
vN <- stitchTS(dat = vN, stitchDate)
vN<-vN%>%mutate(type = "NRS indices")
#plotTS(vN)
rm(df)
df <- get_var( typeIN    = "monthly",
monthIN   = 4:6,
plotbasin  = c("SEBS"),
plotvar   = "uEast_surface5m",
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
uE <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
uE <- stitchTS(dat = uE, stitchDate)
uE<-uE%>%mutate(type = "NRS indices")
NRS_vars <- rbind(vN,uE)
rm(df)
varlist <- c("temp_bottom5m", "fracbelow2","pH_depthavg")
for(v in varlist){
# get the variable you want:
df <- get_var( typeIN    = "seasonal",
SeasonIN =  "Summer",
plotbasin  = c("SEBS"),
plotvar   = v,
bcIN      = "bias corrected",
CMIPIN    = "K20P19_CMIP6",
plothist  = T,  # ignore the hist runs
removeyr1 = T)  # "Remove first year of projection ( burn in)")
tmp <- df$dat%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(sumat), mean, na.rm=T)
tmp <- stitchTS(dat = tmp, stitchDate)
tmp<-tmp%>%mutate(type = "NRS indices")
NRS_vars <- rbind(NRS_vars,tmp)
rm(df)
}
NRS_vars<-NRS_vars%>%ungroup()
plotTS(NRS_vars )
save(NRS_vars, file="Data/out/NRS_vars.Rdata")
wide<- NRS_vars%>%group_by(across(all_of(grpby)))%>%
summarize_at(all_of(c("mn_val")), mean, na.rm=T)%>%
tidyr::pivot_wider(names_from = var, values_from = mn_val)
aa<-NRS_vars%>%filter(var=="temp_bottom5m",GCM_scen=="miroc_ssp585")
aa$year[is.na(aa$mn_val)]
plotTS(aa)
head(wide)
head(wide[,-1:6])
head(wide[,-(1:6)])
head(wide[,-(1:9)])
tail(wide[,-(1:9)])
ggplot(wide)+geom_line(aes(x=year,y=mn_val,color=GCM_scen))+facet_grid(var~.scen)
ggplot(wide)+geom_line(aes(x=year,y=temp_bottom5m,color=GCM_scen))+facet_grid(~.scen)
