# preview the projection and hindcast Level 2 datasets:
proj_l2_datasets  <- tds_list_datasets(proj_l2_cat)
hind_l2_datasets  <- tds_list_datasets(hind_l2_cat)
proj_l2_datasets$dataset
# get url for bottom temperature:
proj_l2_BT_url    <- proj_l2_datasets[proj_l2_datasets$dataset == "Bottom 5m",]$path
hind_l2_BT_url    <- hind_l2_datasets[hind_l2_datasets$dataset == "Bottom 5m",]$path
proj_l2_BT_url
weekly_vars  # list of possible variables in the ACLIMregion_ files
# --------------------------------------
# SETUP WORKSPACE
tmstp  <- format(Sys.time(), "%Y_%m_%d")
main   <- getwd()  #"~/GitHub_new/ACLIM2
source("R/make.R")
# --------------------------------------
# list of the scenario x GCM downscaled ACLIM indices
for(k in aclim)
cat(paste(k,"\n"))
embargoed # not yet public or published
public    # published runs (CMIP5)
# get some info about a scenario:
all_info1 <- info(model_list=aclim,type=1)
all_info2 <- info(model_list=aclim,type=2)
all_info1
all_info2
# variables in each of the two files:
srvy_vars
weekly_vars
#summary tables for variables
srvy_var_def
weekly_var_def
# explore stations in the survey replicated data:
head(station_info)
# first convert the station_info object into a shapefile for mapping:
station_sf         <- convert2shp(station_info)
station_sf$stratum <- factor(station_sf$stratum)
# plot the stations:
p <- plot_stations_basemap(sfIN = station_sf,
fillIN = "subregion",
colorIN = "subregion") +
scale_color_viridis_d(begin = .2,end=.6) +
scale_fill_viridis_d(begin  = .2,end=.6)
if(update.figs){
p
ggsave(file=file.path(main,"Figs/stations_NS.jpg"),width=5,height=5)
}
p2 <- plot_stations_basemap(sfIN = station_sf,fillIN = "stratum",colorIN = "stratum") +
scale_color_viridis_d() +
scale_fill_viridis_d()
if(update.figs){
p2
ggsave(file=file.path(main,"Figs/stations.jpg"),width=5,height=5)}
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
shareddata_path   <-  "Data/in/shared
""
shareddata_path   <-  "Data/in/shared"
load(file.path(shareddata_path,"base_data.Rdata"))
shareddata_path
file.path(shareddata_path,"base_data.Rdata")
shareddata_path
```{r gitdwnld, eval = FALSE,echo =T}
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
map_data_path
mapdata_path     <- "Data/in/Map_layers"
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
nm
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
tmpnms <- c("ne_10m_bathymetry_K_200","ne_10m_bathymetry_J_1000")
# ---------------------------------
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
tmpnms <- c("ne_10m_bathymetry_K_200","ne_10m_bathymetry_J_1000")
nm <- tmpnms[1]
tmp_dest <- file.path( tmp_fldr,paste0(nm,".zip" ))
tmp_url  <- paste0(base_url,paste0(nm,".zip" ))
tmp
tmp_dest
tmp_url
fldrs<-c(file.path(mapdata_path,"shp_files"),
file.path(mapdata_path,"shp_files/global"))
mapdata_path
nn<-10
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
tmp_fldr
nn
nm       <-  paste0(nn,"/physical/",nn,"m_physical.zip")
outfl    <-  paste0("natural_earth_vector/",nn,"m_physical.zip")
nm
outfl
file.path(tmp_fldr,outfl)
paste0(base_url,paste0(nm,".zip" ))
"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/10m_physical.zip"
getZip( url = "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip",
destfile = file.path(mapdata_path,"geo_tif/OB_LR.zip") )
(!dir.exists(file.path(mapdata_path,tmp_fldr,"CNTR_RG_03M_2014")))
nn<-10
nm       <-  paste0(nn,"m/physical/",nn,"m_physical.zip")
outfl    <-  paste0("natural_earth_vector/",nn,"m_physical.zip")
(!dir.exists(file.path(tmp_fldr,paste0("natural_earth_vector/",nn,"m_physical")  )))
file.path( tmp_fldr,paste0(nm,".zip" ))
nm <- tmpnms
file.path( tmp_fldr,paste0(nm,".zip" ))
(!dir.exists( file.path( tmp_fldr,nm)   ))
nm
if(!file.exists(file.path(mapdata_path,"geo_tif/OB_LR") ))
getZip( url = "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip",
destfile = file.path(mapdata_path,"geo_tif/OB_LR.zip") )
(!file.exists(file.path(mapdata_path,"geo_tif/OB_LR") ))
mapdata_path
dir(mapdata_path)
getwd()
dir(Data)
dir(mapdata_path)
dir("Data")
setwd(" /Users/kholsman/GitHub_new")
setwd(" /Users/kholsman/GitHub_new")
setwd("/Users/kholsman/GitHub_new/ACLIM2")
(!file.exists(file.path(mapdata_path,"geo_tif/OB_LR") ))
#'
#'
#'Get_map_layers.R
#'
# set up folders:
# ---------------------------------
fldrs<-c(file.path(mapdata_path,"shp_files"),
file.path(mapdata_path,"shp_files/global"),
file.path(mapdata_path,"shp_files/global/natural_earth_vector"),
file.path(mapdata_path,"geo_tif"),
file.path(mapdata_path,"geo_tif/OB_LR"))
for(ddir in fldrs){
if(!dir.exists(ddir)) dir.create(ddir)
}
# download blue marble files:
# ---------------------------------
if(!file.exists(file.path(mapdata_path,"geo_tif/blue_marble.tif") ))
download.file(
url ="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57752/land_shallow_topo_8192.tif",
file.path(file.path(mapdata_path,"geo_tif/blue_marble.tif") ))
# download OB_LR
# ---------------------------------
#http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip
# /Users/kholsman/GitHub_new/ACLIM2/Data/in/Map_layers/geo_tif/OB_LR
if(!file.exists(file.path(mapdata_path,"geo_tif/OB_LR") ))
getZip( url = "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip",
destfile = file.path(mapdata_path,"geo_tif/OB_LR.zip") )
## CNTR_RG_03M_2014
# ---------------------------------
#C NTR_RG_03M_2014
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
if(!dir.exists(file.path(mapdata_path,tmp_fldr,"CNTR_RG_03M_2014"))){
getZip(
url     = "https://dominicroye.github.io/files/CNTR_RG_03M_2014.zip",
destfile = file.path( tmp_fldr,"CNTR_RG_03M_2014.zip") )
}
# natural_earth_vector
# ---------------------------------
#10m
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/10m_physical.zip
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/physical/50m_physical.zip
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/physical/110m_physical.zip
for(nn in c(10.50,110) ){
nm       <-  paste0(nn,"m/physical/",nn,"m_physical.zip")
outfl    <-  paste0("natural_earth_vector/",nn,"m_physical.zip")
if(!dir.exists(file.path(tmp_fldr,paste0("natural_earth_vector/",nn,"m_physical")  )))
getZip( url = paste0(base_url,nm), destfile = file.path(tmp_fldr,outfl) )
}
# natural earth shp downloads:
# ---------------------------------
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
tmpnms <- c("ne_10m_bathymetry_K_200","ne_10m_bathymetry_J_1000")
for(nm in tmpnms){
if(!dir.exists( file.path( tmp_fldr,nm)   ) )
getZip( url = paste0(base_url,paste0(nm,".zip" )),
destfile = file.path( tmp_fldr,paste0(nm,".zip" )) )
}
getZip <- function(url,destfile, deletezip=T){
download.file(url=url, destfile=destfile)
unzip (destfile, exdir = "./",overwrite = T)
if(deletezip)
file.remove(destfile)
}
#'
#'
#'Get_map_layers.R
#'
# set up folders:
# ---------------------------------
fldrs<-c(file.path(mapdata_path,"shp_files"),
file.path(mapdata_path,"shp_files/global"),
file.path(mapdata_path,"shp_files/global/natural_earth_vector"),
file.path(mapdata_path,"geo_tif"),
file.path(mapdata_path,"geo_tif/OB_LR"))
for(ddir in fldrs){
if(!dir.exists(ddir)) dir.create(ddir)
}
# download blue marble files:
# ---------------------------------
if(!file.exists(file.path(mapdata_path,"geo_tif/blue_marble.tif") ))
download.file(
url ="https://eoimages.gsfc.nasa.gov/images/imagerecords/57000/57752/land_shallow_topo_8192.tif",
file.path(file.path(mapdata_path,"geo_tif/blue_marble.tif") ))
# download OB_LR
# ---------------------------------
#http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip
# /Users/kholsman/GitHub_new/ACLIM2/Data/in/Map_layers/geo_tif/OB_LR
if(!file.exists(file.path(mapdata_path,"geo_tif/OB_LR") ))
getZip( url = "http://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/raster/OB_LR.zip",
destfile = file.path(mapdata_path,"geo_tif/OB_LR.zip") )
## CNTR_RG_03M_2014
# ---------------------------------
#C NTR_RG_03M_2014
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
if(!dir.exists(file.path(mapdata_path,tmp_fldr,"CNTR_RG_03M_2014"))){
getZip(
url     = "https://dominicroye.github.io/files/CNTR_RG_03M_2014.zip",
destfile = file.path( tmp_fldr,"CNTR_RG_03M_2014.zip") )
}
# natural_earth_vector
# ---------------------------------
#10m
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/10m_physical.zip
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/50m/physical/50m_physical.zip
# https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/110m/physical/110m_physical.zip
for(nn in c(10.50,110) ){
nm       <-  paste0(nn,"m/physical/",nn,"m_physical.zip")
outfl    <-  paste0("natural_earth_vector/",nn,"m_physical.zip")
if(!dir.exists(file.path(tmp_fldr,paste0("natural_earth_vector/",nn,"m_physical")  )))
getZip( url = paste0(base_url,nm), destfile = file.path(tmp_fldr,outfl) )
}
# natural earth shp downloads:
# ---------------------------------
base_url <-"https://www.naturalearthdata.com/http//www.naturalearthdata.com/download/10m/physical/"
tmp_fldr <-  file.path(mapdata_path,"shp_files/global")
tmpnms <- c("ne_10m_bathymetry_K_200","ne_10m_bathymetry_J_1000")
for(nm in tmpnms){
if(!dir.exists( file.path( tmp_fldr,nm)   ) )
getZip( url = paste0(base_url,paste0(nm,".zip" )),
destfile = file.path( tmp_fldr,paste0(nm,".zip" )) )
}
# set up folders:
# ---------------------------------
fldrs<-c(file.path(mapdata_path,"shp_files"),
file.path(mapdata_path,"shp_files/global"),
file.path(mapdata_path,"shp_files/global/natural_earth_vector"),
file.path(mapdata_path,"geo_tif"),
file.path(mapdata_path,"geo_tif/OB_LR"))
for(ddir in fldrs){
if(!dir.exists(ddir)) dir.create(ddir)
}
getwd()
dir(mapdata_path)
shp_dir,"global/natural_earth_vector/110m_physical")
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
# ----------------------------------------
# packages.R
# load or install packages
# subset of Holsman et al. 2020 ACLIM Simulations
# kirstin.holsman@noaa.gov
# updated 2020
# ----------------------------------------
lib_list <- c(
# these for reshaping and manipulating data:
"ncdf4",
"devtools",
# "ncfd",
"magrittr",
"httr",
"reshape",
"dplyr",
"purrr",
"readxl",
"tidyverse",
# these for ggplot mapping:
"raster",
"ggspatial",             # used for N arrow and scale bar
"sf",                    # used for shapefiles
"rnaturalearth",         # has more shapefiles; used to make the "world" object
"maps",                  # has some state shapefiles, need to be converted with st_as_sf
"akima",                 # Interpolation of Irregularly and Regularly Spaced Data
# markdown stuff:
"knitr",
"kableExtra",
# These for making plots:
"RColorBrewer",
"ggplot2",
"mgcv",
"cowplot",               #
"wesanderson",
"scales",
"ggforce",
"grid",
"processx",
"plotly",
"extrafont"
)
# Install missing libraries:
missing <- setdiff(lib_list, installed.packages()[, 1])
if (length(missing) > 0) install.packages(missing)
# Load libraries:
for(lib in lib_list)
eval(parse(text=paste("library(",lib,")")))
## same for git libraries
lib_list_git <- c(
"thredds")
missing <- setdiff(lib_list_git, installed.packages()[, 1])
if (length(missing) > 0) devtools::install_github("bocinsky/thredds")
# Load libraries:
for(lib in lib_list_git)
eval(parse(text=paste("library(",lib,")")))
lib_list_git
# Specify the download directory
main_nm       <- "ACLIM2"
download_path <- path.expand("~/desktop")
dest_fldr     <- file.path(download_path,main_nm)
url           <- "https://github.com/kholsman/ACLIM2/archive/main.zip"
dest_file     <- file.path(download_path,paste0(main_nm,".zip"))
download.file(url=url, destfile=dest_file)
# unzip the .zip file
setwd(download_path)
unzip (dest_file, exdir = "./",overwrite = T)
#rename the unzipped folder from ACLIM2-main to ACLIM2
file.rename(paste0(main_nm,"-main"), main_nm)
setwd(main_nm)
